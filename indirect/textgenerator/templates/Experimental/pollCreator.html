<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pollCreator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background-color: #fff;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        h1 {
            font-size: 2em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }
        h2 {
            font-size: 1.5em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }
        a {
            color: #0366d6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        code {
            background-color: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 85%;
        }
        pre {
            background-color: #f6f8fa;
            padding: 16px;
            overflow: auto;
            border-radius: 3px;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        blockquote {
            border-left: 4px solid #dfe2e5;
            padding-left: 16px;
            color: #6a737d;
            margin: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        table th, table td {
            border: 1px solid #dfe2e5;
            padding: 6px 13px;
        }
        table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }
        ul, ol {
            padding-left: 2em;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 16px;
            background-color: #f1f3f5;
            border-radius: 4px;
            color: #0366d6;
        }
        .back-link:hover {
            background-color: #e1e4e8;
            text-decoration: none;
        }
        .banner-image {
            width: 100%;
            max-height: 200px;
            overflow: hidden;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .banner-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Index</a>
    
    <h2 id="-generate">- generate</h2>
<h1 id="poll-creator-template">Poll Creator Template</h1>
<p>This template creates interactive polls that can be linked to from discussions and automatically registers them in the knowledge graph.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">{{</span><span class="m m-Attribute">#script</span><span class="cp">}}</span>
<span class="x">```js</span>
<span class="x">    // Poll creation and registration system</span>
<span class="x">    async function createPoll(title, description, options, settings = </span><span class="err">{</span><span class="x">}) </span><span class="err">{</span>
<span class="x">        const pollId = `poll-$</span><span class="err">{</span><span class="x">Date.now()}-$</span><span class="err">{</span><span class="x">Math.random().toString(36).substr(2, 9)}`;</span>
<span class="x">        const timestamp = new Date().toISOString();</span>

<span class="x">        const poll = </span><span class="err">{</span>
<span class="x">            id: pollId,</span>
<span class="x">            title: title,</span>
<span class="x">            description: description,</span>
<span class="x">            options: options.map((option, index) =&gt; (</span><span class="err">{</span>
<span class="x">                id: index,</span>
<span class="x">                text: option,</span>
<span class="x">                votes: 0</span>
<span class="x">            })),</span>
<span class="x">            createdAt: timestamp,</span>
<span class="x">            isActive: true,</span>
<span class="x">            settings: </span><span class="err">{</span>
<span class="x">                allowMultipleVotes: settings.allowMultipleVotes || false,</span>
<span class="x">                showResults: settings.showResults !== false,</span>
<span class="x">                anonymous: settings.anonymous !== false,</span>
<span class="x">                ...settings</span>
<span class="x">            }</span>
<span class="x">        };</span>

<span class="x">        // Create poll file</span>
<span class="x">        const pollFilePath = `polls/$</span><span class="err">{</span><span class="x">pollId}.md`;</span>
<span class="x">        const currentFolder = app.workspace.getActiveFile()?.parent?.path || &#39;&#39;;</span>
<span class="x">        const fullPollPath = currentFolder ? `$</span><span class="err">{</span><span class="x">currentFolder}/$</span><span class="err">{</span><span class="x">pollFilePath}` : pollFilePath;</span>

<span class="x">        // Ensure polls directory exists</span>
<span class="x">        const pollsDir = currentFolder ? `$</span><span class="err">{</span><span class="x">currentFolder}/polls` : &#39;polls&#39;;</span>
<span class="x">        if (!await app.vault.adapter.exists(pollsDir)) </span><span class="err">{</span>
<span class="x">            await app.vault.createFolder(pollsDir);</span>
<span class="x">        }</span>

<span class="x">        const pollContent = generatePollMarkdown(poll);</span>

<span class="x">        try </span><span class="err">{</span>
<span class="x">            await app.vault.create(fullPollPath, pollContent);</span>

<span class="x">            // Register poll in the conceptLinker system</span>
<span class="x">            await registerPollObject(poll, fullPollPath);</span>

<span class="x">            return </span><span class="err">{</span>
<span class="x">                success: true,</span>
<span class="x">                pollId: pollId,</span>
<span class="x">                path: fullPollPath,</span>
<span class="x">                linkText: `[[$</span><span class="err">{</span><span class="x">pollId}|$</span><span class="err">{</span><span class="x">title}]]`</span>
<span class="x">            };</span>
<span class="x">        } catch (error) </span><span class="err">{</span>
<span class="x">            console.error(&#39;Failed to create poll:&#39;, error);</span>
<span class="x">            return </span><span class="err">{</span>
<span class="x">                success: false,</span>
<span class="x">                error: error.message</span>
<span class="x">            };</span>
<span class="x">        }</span>
<span class="x">    }</span>

<span class="x">    function generatePollMarkdown(poll) </span><span class="err">{</span>
<span class="x">        const optionsHtml = poll.options.map(option =&gt; </span>
<span class="x">            `- [ ] $</span><span class="err">{</span><span class="x">option.text} ($</span><span class="err">{</span><span class="x">option.votes} votes)`</span>
<span class="x">        ).join(&#39;\n&#39;);</span>

<span class="x">        return `---</span>
<span class="x">title: $</span><span class="err">{</span><span class="x">poll.title}</span>
<span class="x">type: poll</span>
<span class="x">pollId: $</span><span class="err">{</span><span class="x">poll.id}</span>
<span class="x">createdAt: $</span><span class="err">{</span><span class="x">poll.createdAt}</span>
<span class="x">isActive: $</span><span class="err">{</span><span class="x">poll.isActive}</span>
<span class="x">tags: [poll, discussion, voting]</span>
<span class="x">---</span>

<span class="x"># üìä $</span><span class="err">{</span><span class="x">poll.title}</span>

<span class="x">$</span><span class="err">{</span><span class="x">poll.description}</span>

<span class="x">## Options</span>

<span class="x">$</span><span class="err">{</span><span class="x">optionsHtml}</span>

<span class="x">## Poll Information</span>

<span class="x">- **Poll ID**: \`$</span><span class="err">{</span><span class="x">poll.id}\`</span>
<span class="x">- **Created**: $</span><span class="err">{</span><span class="x">poll.createdAt}</span>
<span class="x">- **Status**: $</span><span class="err">{</span><span class="x">poll.isActive ? &#39;Active&#39; : &#39;Closed&#39;}</span>
<span class="x">- **Multiple Votes**: $</span><span class="err">{</span><span class="x">poll.settings.allowMultipleVotes ? &#39;Allowed&#39; : &#39;Not Allowed&#39;}</span>
<span class="x">- **Anonymous**: $</span><span class="err">{</span><span class="x">poll.settings.anonymous ? &#39;Yes&#39; : &#39;No&#39;}</span>

<span class="x">## How to Vote</span>

<span class="x">1. Check the box next to your preferred option(s)</span>
<span class="x">2. Save the file to record your vote</span>
<span class="x">3. Results are $</span><span class="err">{</span><span class="x">poll.settings.showResults ? &#39;visible to all&#39; : &#39;hidden until poll closes&#39;}</span>

<span class="x">---</span>
<span class="x">*This is an interactive poll. You can link to it using: \`[[$</span><span class="err">{</span><span class="x">poll.id}]]\`*</span>
<span class="x">`;</span>
<span class="x">    }</span>

<span class="x">    async function registerPollObject(poll, filePath) </span><span class="err">{</span>
<span class="x">        try </span><span class="err">{</span>
<span class="x">            // Register in a polls index file for easy discovery</span>
<span class="x">            const pollsIndexPath = &#39;polls/polls-index.md&#39;;</span>

<span class="x">            let indexContent = &#39;&#39;;</span>
<span class="x">            if (await app.vault.adapter.exists(pollsIndexPath)) </span><span class="err">{</span>
<span class="x">                indexContent = await app.vault.adapter.read(pollsIndexPath);</span>
<span class="x">            } else </span><span class="err">{</span>
<span class="x">                indexContent = `---</span>
<span class="x">title: Polls Index</span>
<span class="x">type: poll-index</span>
<span class="x">tags: [polls, index]</span>
<span class="x">---</span>

<span class="x"># üìä Polls Index</span>

<span class="x">This file tracks all polls for easy linking and discovery.</span>

<span class="x">## Active Polls</span>

<span class="x">`;</span>
<span class="x">            }</span>

<span class="x">            // Add poll entry to index</span>
<span class="x">            const pollEntry = `- [[$</span><span class="err">{</span><span class="x">poll.id}|$</span><span class="err">{</span><span class="x">poll.title}]] - Created: $</span><span class="err">{</span><span class="x">poll.createdAt}\n`;</span>

<span class="x">            if (indexContent.includes(&#39;## Active Polls&#39;)) </span><span class="err">{</span>
<span class="x">                indexContent = indexContent.replace(</span>
<span class="x">                    &#39;## Active Polls\n&#39;,</span>
<span class="x">                    `## Active Polls\n\n$</span><span class="err">{</span><span class="x">pollEntry}`</span>
<span class="x">                );</span>
<span class="x">            } else </span><span class="err">{</span>
<span class="x">                indexContent += `\n$</span><span class="err">{</span><span class="x">pollEntry}`;</span>
<span class="x">            }</span>

<span class="x">            await app.vault.adapter.write(pollsIndexPath, indexContent);</span>

<span class="x">            return true;</span>
<span class="x">        } catch (error) </span><span class="err">{</span>
<span class="x">            console.error(&#39;Failed to register poll object:&#39;, error);</span>
<span class="x">            return false;</span>
<span class="x">        }</span>
<span class="x">    }</span>

<span class="x">    // Parse input from the selection or prompt</span>
<span class="x">    async function parsePollInput(input) </span><span class="err">{</span>
<span class="x">        const lines = input.split(&#39;\n&#39;).map(line =&gt; line.trim()).filter(line =&gt; line.length &gt; 0);</span>

<span class="x">        if (lines.length &lt; 3) </span><span class="err">{</span>
<span class="x">            throw new Error(&#39;Poll must have at least a title, description, and two options&#39;);</span>
<span class="x">        }</span>

<span class="x">        const title = lines[0].replace(/^#+\s*/, &#39;&#39;); // Remove markdown headers</span>
<span class="x">        const description = lines[1];</span>
<span class="x">        const options = lines.slice(2);</span>

<span class="x">        return </span><span class="err">{</span><span class="x"> title, description, options };</span>
<span class="x">    }</span>

<span class="x">    // Main execution</span>
<span class="x">    async function generatePoll() </span><span class="err">{</span>
<span class="x">        try </span><span class="err">{</span>
<span class="x">            const selection = `</span><span class="cp">{{</span><span class="nv">tg_selection</span><span class="cp">}}</span><span class="x">`.trim();</span>

<span class="x">            if (!selection) </span><span class="err">{</span>
<span class="x">                return `# Poll Creator</span>

<span class="x">Please provide poll information in the following format:</span>

<span class="x">Poll Title</span>
<span class="x">Poll description explaining what this poll is about</span>
<span class="x">Option 1</span>
<span class="x">Option 2</span>
<span class="x">Option 3</span>
<span class="x">...</span>

<span class="x">Then run this template again with your poll information selected.`;</span>
<span class="x">            }</span>

<span class="x">            const </span><span class="err">{</span><span class="x"> title, description, options } = await parsePollInput(selection);</span>
<span class="x">            const result = await createPoll(title, description, options);</span>

<span class="x">            if (result.success) </span><span class="err">{</span>
<span class="x">                return `# Poll Created Successfully! </span>

<span class="x">**Poll ID**: \`$</span><span class="err">{</span><span class="x">result.pollId}\`</span>
<span class="x">**File**: $</span><span class="err">{</span><span class="x">result.path}</span>
<span class="x">**Link**: $</span><span class="err">{</span><span class="x">result.linkText}</span>

<span class="x">Your poll has been created and is now available for linking in discussions. </span>

<span class="x">## Quick Actions</span>

<span class="x">- View poll: [[$</span><span class="err">{</span><span class="x">result.pollId}]]</span>
<span class="x">- Copy link: \`[[$</span><span class="err">{</span><span class="x">result.pollId}|$</span><span class="err">{</span><span class="x">title}]]\`</span>
<span class="x">- View all polls: [[polls-index]]</span>

<span class="x">The poll has been automatically registered in the knowledge graph and can be discovered by the conceptLinker system.`;</span>
<span class="x">            } else </span><span class="err">{</span>
<span class="x">                return `# Poll Creation Failed</span>

<span class="x">Error: $</span><span class="err">{</span><span class="x">result.error}</span>

<span class="x">Please check your input format and try again.`;</span>
<span class="x">            }</span>

<span class="x">        } catch (error) </span><span class="err">{</span>
<span class="x">            return `# Error Creating Poll</span>

<span class="x">$</span><span class="err">{</span><span class="x">error.message}</span>

<span class="x">## Expected Format:</span>

<span class="x">Poll Title</span>
<span class="x">Poll description</span>
<span class="x">Option 1</span>
<span class="x">Option 2</span>
<span class="x">Option 3`;</span>
<span class="x">        }</span>
<span class="x">    }</span>

<span class="x">    return await generatePoll();</span>
</code></pre></div>

<p>{{/script}}
```</p>
<hr />
<hr />
<h1 id="output">Output:</h1>
<p>{{get "script"}}</p>
<!-- 40A640EB -->
</body>
</html>