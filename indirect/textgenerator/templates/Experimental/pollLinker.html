<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pollLinker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background-color: #fff;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        h1 {
            font-size: 2em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }
        h2 {
            font-size: 1.5em;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }
        a {
            color: #0366d6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
        }
        code {
            background-color: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 85%;
        }
        pre {
            background-color: #f6f8fa;
            padding: 16px;
            overflow: auto;
            border-radius: 3px;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        blockquote {
            border-left: 4px solid #dfe2e5;
            padding-left: 16px;
            color: #6a737d;
            margin: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        table th, table td {
            border: 1px solid #dfe2e5;
            padding: 6px 13px;
        }
        table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }
        ul, ol {
            padding-left: 2em;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 16px;
            background-color: #f1f3f5;
            border-radius: 4px;
            color: #0366d6;
        }
        .back-link:hover {
            background-color: #e1e4e8;
            text-decoration: none;
        }
        .banner-image {
            width: 100%;
            max-height: 200px;
            overflow: hidden;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .banner-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back to Index</a>
    
    <h2 id="-generate">- generate</h2>
<h1 id="poll-linker-template">Poll Linker Template</h1>
<p>This template enhances the conceptLinker system to automatically find and link poll objects in discussions.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">{{</span><span class="m m-Attribute">#script</span><span class="cp">}}</span>
<span class="x">```js</span>
<span class="x">    // Enhanced poll discovery and linking system</span>
<span class="x">    async function findPollObjects() </span><span class="err">{</span>
<span class="x">        const polls = [];</span>

<span class="x">        try </span><span class="err">{</span>
<span class="x">            // Check if polls directory exists</span>
<span class="x">            const pollsDir = &#39;polls&#39;;</span>
<span class="x">            if (await app.vault.adapter.exists(pollsDir)) </span><span class="err">{</span>
<span class="x">                const pollFiles = await app.vault.adapter.list(pollsDir);</span>

<span class="x">                for (const file of pollFiles.files) </span><span class="err">{</span>
<span class="x">                    if (file.endsWith(&#39;.md&#39;) &amp;&amp; !file.endsWith(&#39;polls-index.md&#39;)) </span><span class="err">{</span>
<span class="x">                        try </span><span class="err">{</span>
<span class="x">                            const content = await app.vault.adapter.read(file);</span>
<span class="x">                            const poll = parsePollFromContent(content, file);</span>
<span class="x">                            if (poll) </span><span class="err">{</span>
<span class="x">                                polls.push(poll);</span>
<span class="x">                            }</span>
<span class="x">                        } catch (error) </span><span class="err">{</span>
<span class="x">                            console.warn(`Could not read poll file $</span><span class="err">{</span><span class="x">file}:`, error);</span>
<span class="x">                        }</span>
<span class="x">                    }</span>
<span class="x">                }</span>
<span class="x">            }</span>

<span class="x">            // Also search for polls in current directory</span>
<span class="x">            const currentFile = app.workspace.getActiveFile();</span>
<span class="x">            if (currentFile?.parent) </span><span class="err">{</span>
<span class="x">                const currentDir = currentFile.parent.path;</span>
<span class="x">                const localPollsDir = `$</span><span class="err">{</span><span class="x">currentDir}/polls`;</span>

<span class="x">                if (await app.vault.adapter.exists(localPollsDir)) </span><span class="err">{</span>
<span class="x">                    const localPollFiles = await app.vault.adapter.list(localPollsDir);</span>

<span class="x">                    for (const file of localPollFiles.files) </span><span class="err">{</span>
<span class="x">                        if (file.endsWith(&#39;.md&#39;) &amp;&amp; !file.endsWith(&#39;polls-index.md&#39;)) </span><span class="err">{</span>
<span class="x">                            try </span><span class="err">{</span>
<span class="x">                                const content = await app.vault.adapter.read(file);</span>
<span class="x">                                const poll = parsePollFromContent(content, file);</span>
<span class="x">                                if (poll) </span><span class="err">{</span>
<span class="x">                                    polls.push(poll);</span>
<span class="x">                                }</span>
<span class="x">                            } catch (error) </span><span class="err">{</span>
<span class="x">                                console.warn(`Could not read local poll file $</span><span class="err">{</span><span class="x">file}:`, error);</span>
<span class="x">                            }</span>
<span class="x">                        }</span>
<span class="x">                    }</span>
<span class="x">                }</span>
<span class="x">            }</span>
<span class="x">        } catch (error) </span><span class="err">{</span>
<span class="x">            console.error(&#39;Error finding poll objects:&#39;, error);</span>
<span class="x">        }</span>

<span class="x">        return polls;</span>
<span class="x">    }</span>

<span class="x">    function parsePollFromContent(content, filePath) </span><span class="err">{</span>
<span class="x">        try </span><span class="err">{</span>
<span class="x">            // Extract frontmatter</span>
<span class="x">            const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---/);</span>
<span class="x">            if (!frontmatterMatch) return null;</span>

<span class="x">            const frontmatter = frontmatterMatch[1];</span>
<span class="x">            const pollIdMatch = frontmatter.match(/pollId:\s*(.+)/);</span>
<span class="x">            const titleMatch = frontmatter.match(/title:\s*(.+)/);</span>
<span class="x">            const typeMatch = frontmatter.match(/type:\s*(.+)/);</span>

<span class="x">            if (!pollIdMatch || typeMatch?.[1] !== &#39;poll&#39;) return null;</span>

<span class="x">            const pollId = pollIdMatch[1].trim();</span>
<span class="x">            const title = titleMatch?.[1]?.trim() || pollId;</span>

<span class="x">            // Extract description from content</span>
<span class="x">            const bodyContent = content.replace(/^---\n[\s\S]*?\n---/, &#39;&#39;).trim();</span>
<span class="x">            const descriptionMatch = bodyContent.match(/# [^\n]+\n\n([^\n]+)/);</span>
<span class="x">            const description = descriptionMatch?.[1] || &#39;&#39;;</span>

<span class="x">            return </span><span class="err">{</span>
<span class="x">                id: pollId,</span>
<span class="x">                title: title,</span>
<span class="x">                description: description,</span>
<span class="x">                filePath: filePath,</span>
<span class="x">                linkText: `[[$</span><span class="err">{</span><span class="x">pollId}|$</span><span class="err">{</span><span class="x">title}]]`</span>
<span class="x">            };</span>
<span class="x">        } catch (error) </span><span class="err">{</span>
<span class="x">            console.warn(&#39;Error parsing poll content:&#39;, error);</span>
<span class="x">            return null;</span>
<span class="x">        }</span>
<span class="x">    }</span>

<span class="x">    async function findRelevantPolls(text, polls) </span><span class="err">{</span>
<span class="x">        const relevantPolls = [];</span>
<span class="x">        const words = text.toLowerCase().split(/\s+/);</span>

<span class="x">        for (const poll of polls) </span><span class="err">{</span>
<span class="x">            const pollWords = (poll.title + &#39; &#39; + poll.description).toLowerCase().split(/\s+/);</span>

<span class="x">            // Calculate relevance score</span>
<span class="x">            let score = 0;</span>
<span class="x">            for (const word of words) </span><span class="err">{</span>
<span class="x">                if (word.length &gt; 3) </span><span class="err">{</span><span class="x"> // Skip short words</span>
<span class="x">                    for (const pollWord of pollWords) </span><span class="err">{</span>
<span class="x">                        if (pollWord.includes(word) || word.includes(pollWord)) </span><span class="err">{</span>
<span class="x">                            score++;</span>
<span class="x">                        }</span>
<span class="x">                    }</span>
<span class="x">                }</span>
<span class="x">            }</span>

<span class="x">            // Check for specific poll-related keywords</span>
<span class="x">            const pollKeywords = [&#39;vote&#39;, &#39;poll&#39;, &#39;survey&#39;, &#39;opinion&#39;, &#39;decide&#39;, &#39;choice&#39;, &#39;select&#39;];</span>
<span class="x">            for (const keyword of pollKeywords) </span><span class="err">{</span>
<span class="x">                if (text.toLowerCase().includes(keyword)) </span><span class="err">{</span>
<span class="x">                    score += 2;</span>
<span class="x">                }</span>
<span class="x">            }</span>

<span class="x">            if (score &gt; 0) </span><span class="err">{</span>
<span class="x">                relevantPolls.push(</span><span class="err">{</span>
<span class="x">                    ...poll,</span>
<span class="x">                    relevanceScore: score</span>
<span class="x">                });</span>
<span class="x">            }</span>
<span class="x">        }</span>

<span class="x">        // Sort by relevance score</span>
<span class="x">        return relevantPolls.sort((a, b) =&gt; b.relevanceScore - a.relevanceScore);</span>
<span class="x">    }</span>

<span class="x">    async function enhanceTextWithPollLinks(text) </span><span class="err">{</span>
<span class="x">        const polls = await findPollObjects();</span>

<span class="x">        if (polls.length === 0) </span><span class="err">{</span>
<span class="x">            return </span><span class="err">{</span>
<span class="x">                enhancedText: text,</span>
<span class="x">                foundPolls: [],</span>
<span class="x">                message: &quot;No poll objects found. Create polls using the pollCreator template.&quot;</span>
<span class="x">            };</span>
<span class="x">        }</span>

<span class="x">        const relevantPolls = await findRelevantPolls(text, polls);</span>

<span class="x">        if (relevantPolls.length === 0) </span><span class="err">{</span>
<span class="x">            return </span><span class="err">{</span>
<span class="x">                enhancedText: text,</span>
<span class="x">                foundPolls: polls,</span>
<span class="x">                message: `Found $</span><span class="err">{</span><span class="x">polls.length} poll(s) but none are relevant to this discussion.`</span>
<span class="x">            };</span>
<span class="x">        }</span>

<span class="x">        // Add poll links section to the text</span>
<span class="x">        const pollLinksSection = `</span>

<span class="x">## üìä Related Polls</span>

<span class="x">$</span><span class="err">{</span><span class="x">relevantPolls.map(poll =&gt; </span>
<span class="x">    `- $</span><span class="err">{</span><span class="x">poll.linkText} - $</span><span class="err">{</span><span class="x">poll.description}`</span>
<span class="x">).join(&#39;\n&#39;)}</span>

<span class="x">---</span>
<span class="x">*Auto-linked polls based on discussion content*`;</span>

<span class="x">        return </span><span class="err">{</span>
<span class="x">            enhancedText: text + pollLinksSection,</span>
<span class="x">            foundPolls: polls,</span>
<span class="x">            relevantPolls: relevantPolls,</span>
<span class="x">            message: `Enhanced discussion with $</span><span class="err">{</span><span class="x">relevantPolls.length} relevant poll link(s).`</span>
<span class="x">        };</span>
<span class="x">    }</span>

<span class="x">    // Main execution</span>
<span class="x">    async function processPollLinking() </span><span class="err">{</span>
<span class="x">        const selection = `</span><span class="cp">{{</span><span class="nv">tg_selection</span><span class="cp">}}</span><span class="x">`.trim();</span>

<span class="x">        if (!selection) </span><span class="err">{</span>
<span class="x">            const polls = await findPollObjects();</span>

<span class="x">            return `# Poll Linker</span>

<span class="x">## Available Poll Objects</span>

<span class="x">$</span><span class="err">{</span><span class="x">polls.length &gt; 0 ? </span>
<span class="x">    polls.map(poll =&gt; `- $</span><span class="err">{</span><span class="x">poll.linkText} - $</span><span class="err">{</span><span class="x">poll.description}`).join(&#39;\n&#39;) :</span>
<span class="x">    &#39;No poll objects found. Create some using the pollCreator template.&#39;</span>
<span class="x">}</span>

<span class="x">## Usage</span>

<span class="x">Select text from a discussion and run this template to automatically find and link relevant polls.</span>

<span class="x">## Status</span>

<span class="x">- **Total Polls Found**: $</span><span class="err">{</span><span class="x">polls.length}</span>
<span class="x">- **Poll Discovery**: $</span><span class="err">{</span><span class="x">polls.length &gt; 0 ? &#39;‚úÖ Working&#39; : &#39;‚ùå No objects found&#39;}</span>
<span class="x">- **Linking System**: ‚úÖ Active`;</span>
<span class="x">        }</span>

<span class="x">        const result = await enhanceTextWithPollLinks(selection);</span>

<span class="x">        return `# Poll Linking Results</span>

<span class="x">$</span><span class="err">{</span><span class="x">result.message}</span>

<span class="x">## Enhanced Text</span>

<span class="x">$</span><span class="err">{</span><span class="x">result.enhancedText}</span>

<span class="x">## Discovery Summary</span>

<span class="x">- **Total Polls Available**: $</span><span class="err">{</span><span class="x">result.foundPolls.length}</span>
<span class="x">- **Relevant Polls Found**: $</span><span class="err">{</span><span class="x">result.relevantPolls?.length || 0}</span>
<span class="x">- **Status**: $</span><span class="err">{</span><span class="x">result.foundPolls.length &gt; 0 ? &#39;‚úÖ Objects found and linking working&#39; : &#39;‚ùå No objects found - create polls first&#39;}</span>

<span class="x">$</span><span class="err">{</span><span class="x">result.relevantPolls?.length &gt; 0 ? `</span>
<span class="x">## Linked Polls Details</span>

<span class="x">$</span><span class="err">{</span><span class="x">result.relevantPolls.map(poll =&gt; </span>
<span class="x">    `### $</span><span class="err">{</span><span class="x">poll.title}</span>
<span class="x">- **ID**: \`$</span><span class="err">{</span><span class="x">poll.id}\`</span>
<span class="x">- **Relevance Score**: $</span><span class="err">{</span><span class="x">poll.relevanceScore}</span>
<span class="x">- **Link**: $</span><span class="err">{</span><span class="x">poll.linkText}</span>
<span class="x">- **Description**: $</span><span class="err">{</span><span class="x">poll.description}`</span>
<span class="x">).join(&#39;\n\n&#39;)}` : &#39;&#39;}`;</span>
<span class="x">    }</span>

<span class="x">    return await processPollLinking();</span>
</code></pre></div>

<p>{{/script}}
```</p>
<hr />
<hr />
<h1 id="output">Output:</h1>
<p>{{get "script"}}</p>
<!-- 04B8943C -->
</body>
</html>